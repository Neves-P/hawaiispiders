---
title: "Sensitivity analysis"
output: html_notebook
---

Here I present the sensitivity of the model to alternate data sets, each corresponding to a specific interpretation of the phylogenetic data or model parameters.

I compiled 12 alternate data sets from the same spider phylogenies. All data sets and the files needed to produce them are included as data objects on this `R` package. The following table describes the differences between each data set.

## Scenario descriptions
|Scenario|Island Age|Favour cladogenesis|Favour MaxAge|
|:------:|:--------:|:-----------------:|:-----------:|
| y_c_max|   1.2My  |        Yes        |     Yes     |
| y_c_min|   1.2My  |        Yes        |     MinAge  |
| y_c_no |   1.2My  |        Yes        |     Never   |
| o_c_max|   2.4My  |        Yes        |     Yes     |
| o_c_min|   2.4My  |        Yes        |     MinAge  |
| o_c_no |   2.4My  |        Yes        |     Never   |
| y_m_max|   1.2My  |        No         |     Yes     |
| y_m_min|   1.2My  |        No         |     MinAge  |
| y_m_no |   1.2My  |        No         |     Never   |
| o_m_max|   2.4My  |        No         |     Yes     |
| o_m_min|   2.4My  |        No         |     MinAge  |
| o_m_no |   2.4My  |        No         |     Never   |

MinAge favouring in the MaxAge column implies that MaxAgeMinAges are used when a min age is available and the precise colonisation time is available too. Not favouring MaxAge means MinAges only used **iff** the precise colonisation age is unknown and a min age is available. These are the "\_no" scenarios, which are arguable the most realistic ones from an empirical point of view.

Broadly speaking, the data consists of mainly singleton endemic species which colonised the island early. In many cases the colonisation time predates the island age. On scenarios favouring cladogenesis, 33 independent clades are present, while the number increases to 35 on scenarios favouring colonisation. There are 37 species present in total.

```{r Plot}
data("y_c_no", package = "hawaiispiders")
DAISIE::DAISIE_plot_island(y_c_no)

data("o_c_no", package = "hawaiispiders")
DAISIE::DAISIE_plot_island(o_c_no)

data("y_m_no", package = "hawaiispiders")
DAISIE::DAISIE_plot_island(y_c_no)

data("o_m_no", package = "hawaiispiders")
DAISIE::DAISIE_plot_island(o_c_no)
```



## Model fitting

Seven different DAISIE models were fit to each of the data sets. Only constant rate models were used for these analyses.
Fit models are as follows:

* Constant rate diversity dependent model
* Constant rate diversity independent model
* Constant rate diversity dependent model with anagenesis rate fixed to 0
* Constant rate diversity independent model with anagenesis rate fixed to 0
* Constant rate diversity dependent model with cladogenesis rate fixed to 0
* Constant rate diversity independent model with cladogenesis rate fixed to 0

## Sensitivity

After having fit a collection of DAISIE models, senstivity analysis was performed to assess the influence of varying scenarios on the selection of the best model and model rank overall.

```{r Sensitivity, echo=TRUE}
age_names <- c(
  "age_c_max",
  "age_m_max",
  "age_c_min",
  "age_m_min",
  "age_c_no",
  "age_m_no"
)
age_comparisons <- list(
  "age_c_max" = c("y_c_max", "o_c_max"),
  "age_m_max" = c("y_m_max", "o_m_max"),
  "age_c_min" = c("y_c_min", "o_c_min"),
  "age_m_min" = c("y_m_min", "o_m_min"),
  "age_c_no" = c("y_c_min", "o_c_no"),
  "age_m_no" = c("y_m_min", "o_m_no")
)
age_sens <- list()
for (i in seq_along(age_comparisons)) {
  age_sens[[i]] <- DAISIEutils::sensitivity(
    age_comparisons[[i]], full_output = FALSE
  )
}
names(age_sens) <- age_names

rate_names <- c(
  "rate_y_max",
  "rate_y_min",
  "rate_y_no",
  "rate_o_max",
  "rate_o_min",
  "rate_o_no"
)
rate_comparisons <- list(
  "rate_y_max" = c("y_c_max", "y_m_max"),
  "rate_y_min" = c("y_c_min", "y_m_min"),
  "rate_y_no" = c("y_c_no", "y_m_no"),
  "rate_o_max" = c("o_c_max", "o_m_max"),
  "rate_o_min" = c("o_c_min", "o_m_min"),
  "rate_o_no" = c("o_c_no", "o_m_no")
)
rate_sens <- list()
for (i in seq_along(rate_comparisons)) {
  rate_sens[[i]] <- DAISIEutils::sensitivity(
    rate_comparisons[[i]], full_output = FALSE
  )
}
names(rate_sens) <- rate_names
rate_input_rank_sens <- data.frame(lapply(rate_sens, "[[", 1))
rate_model_rank_sens <- data.frame(lapply(rate_sens, "[[", 2))
knitr::kable(rbind(rate_input_rank_sens, rate_model_rank_sens))
rate_model_rankings <- data.frame(lapply(rate_sens, "[[", 3))
knitr::kable(t(rate_model_rankings))

m_age_names <- c(
  "m_age_y_c",
  "m_age_y_m",
  "m_age_o_c",
  "m_age_o_m"
)
m_age_comparisons <- list(
  "m_age_y_c" = c("y_c_max", "y_c_min", "y_c_no"),
  "m_age_y_m" = c("y_m_max", "y_m_min", "y_m_no"),
  "m_age_o_c" = c("o_c_max", "o_c_min", "o_c_no"),
  "m_age_y_m" = c("o_c_max", "o_c_min", "o_c_no")
)
m_age_sens <- list()
for (i in seq_along(m_age_comparisons)) {
  m_age_sens[[i]] <- DAISIEutils::sensitivity(
    m_age_comparisons[[i]], full_output = FALSE
  )
}
names(m_age_sens) <- m_age_names
m_age_input_rank_sens <- data.frame(lapply(m_age_sens, "[[", 1))
m_age_model_rank_sens <- data.frame(lapply(m_age_sens, "[[", 2))
knitr::kable(rbind(m_age_input_rank_sens, m_age_model_rank_sens))
m_age_model_rankings <- data.frame(lapply(m_age_sens, "[[", 3))
knitr::kable(t(m_age_model_rankings))
```


